<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Console web sécurisée pour démarrer et arrêter vos instances AWS EC2.">
    <title>Console EC2 | Start & Stop</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <a class="skip-link" href="#main">Aller au contenu principal</a>

    <header class="app-header">
        <div class="container header-content">
            <div class="header-text">
                <h1>Console de contrôle des instances EC2</h1>
                <p>Initialisez l'accès AWS, filtrez vos instances et exécutez des actions <span class="highlight">Start</span> ou <span class="highlight">Stop</span> en toute simplicité.</p>
            </div>
            <div class="header-meta">
                <span class="badge" aria-label="Cette application n'enregistre pas vos clés">Session locale</span>
                <button class="help-button" type="button" id="openHelp" aria-haspopup="dialog">Guide</button>
            </div>
        </div>
    </header>

    <main class="app-main container" id="main">
        <section class="card" id="credentialsCard">
            <div class="card-header">
                <div>
                    <h2>Connexion AWS</h2>
                    <p class="card-intro">Les identifiants saisis ne quittent jamais votre navigateur. Utilisez idéalement un utilisateur IAM restreint.</p>
                </div>
                <button type="button" class="link-button" id="resetCredentials" aria-label="Réinitialiser les identifiants AWS">Effacer</button>
            </div>
            <form id="credentialsForm" autocomplete="off" spellcheck="false" novalidate>
                <div class="form-grid">
                    <label class="form-field" for="accessKeyId">
                        <span>ID de clé d'accès (AKIA...)</span>
                        <input type="text" id="accessKeyId" name="accessKeyId" required inputmode="latin" autocomplete="off" placeholder="AKIA...">
                    </label>
                    <label class="form-field" for="secretAccessKey">
                        <span>Clé secrète</span>
                        <input type="password" id="secretAccessKey" name="secretAccessKey" required autocomplete="new-password" placeholder="••••••••">
                    </label>
                    <label class="form-field" for="sessionToken">
                        <span>Token de session (optionnel)</span>
                        <input type="text" id="sessionToken" name="sessionToken" autocomplete="off" placeholder="Pour les rôles STS">
                    </label>
                    <label class="form-field" for="region">
                        <span>Région AWS</span>
                        <input type="text" id="region" name="region" required placeholder="eu-west-3">
                    </label>
                </div>
                <div class="form-actions">
                    <label class="checkbox">
                        <input type="checkbox" id="persistSession">
                        <span>Mémoriser dans ce navigateur (localStorage)</span>
                    </label>
                    <button type="submit" class="primary">Initialiser le SDK</button>
                </div>
                <p class="security-note" role="alert">⚠️ Ne saisissez jamais de clés root. Privilégiez un rôle avec permissions limitées (`ec2:Describe*`, `ec2:StartInstances`, `ec2:StopInstances`).</p>
            </form>
        </section>

        <section class="card" id="filtersCard">
            <div class="card-header">
                <div>
                    <h2>Filtres d'instances</h2>
                    <p class="card-intro">Filtrez par identifiant, tag ou état pour cibler rapidement les ressources souhaitées.</p>
                </div>
            </div>
            <form id="filtersForm" class="filters" autocomplete="off">
                <div class="form-grid">
                    <label class="form-field" for="instanceId">
                        <span>ID d'instance</span>
                        <input type="text" id="instanceId" name="instanceId" placeholder="i-0abcd1234ef567890">
                    </label>
                    <label class="form-field" for="tagKey">
                        <span>Tag (clé)</span>
                        <input type="text" id="tagKey" name="tagKey" placeholder="Environment">
                    </label>
                    <label class="form-field" for="tagValue">
                        <span>Tag (valeur)</span>
                        <input type="text" id="tagValue" name="tagValue" placeholder="Production">
                    </label>
                    <label class="form-field" for="state">
                        <span>État</span>
                        <select id="state" name="state">
                            <option value="all">Tous</option>
                            <option value="pending">pending</option>
                            <option value="running">running</option>
                            <option value="stopping">stopping</option>
                            <option value="stopped">stopped</option>
                            <option value="shutting-down">shutting-down</option>
                            <option value="terminated">terminated</option>
                        </select>
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="primary" id="listInstances" disabled>Liste des instances</button>
                    <button type="button" class="ghost" id="refreshInstances" disabled>Rafraîchir</button>
                </div>
            </form>
        </section>

        <section class="card" id="instancesCard" aria-live="polite">
            <div class="card-header">
                <div>
                    <h2>Instances EC2</h2>
                    <p class="card-intro">Les actions sont exécutées immédiatement via l'API AWS. Vérifiez les autorisations avant de poursuivre.</p>
                </div>
                <div class="legend">
                    <span class="status-chip running">running</span>
                    <span class="status-chip stopped">stopped</span>
                    <span class="status-chip others">autres états</span>
                </div>
            </div>
            <div id="feedback" class="feedback" role="status" aria-live="assertive"></div>
            <div class="table-wrapper" role="region" aria-label="Liste des instances EC2">
                <table>
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>ID</th>
                            <th>Type</th>
                            <th>Zone</th>
                            <th>État</th>
                            <th>Lancement</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="instancesTableBody">
                        <tr>
                            <td colspan="7" class="empty">Initialisez l'accès AWS puis lancez une recherche pour afficher vos instances.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        <div class="container footer-content">
            <div>
                <strong>Bonnes pratiques</strong>
                <ul>
                    <li>Utilisez des clés IAM temporaires ou des rôles AWS SSO.</li>
                    <li>Limitez les permissions au strict nécessaire.</li>
                    <li>Pensez à activer CloudTrail pour historiser les actions.</li>
                </ul>
            </div>
            <div class="footer-links">
                <a href="https://docs.aws.amazon.com/fr_fr/sdk-for-javascript/v2/developer-guide/" target="_blank" rel="noopener">Documentation SDK</a>
                <a href="https://console.aws.amazon.com/ec2/" target="_blank" rel="noopener">Console AWS</a>
            </div>
        </div>
    </footer>

    <dialog id="helpDialog" aria-modal="true">
        <form method="dialog">
            <h2>Guide rapide</h2>
            <ol>
                <li>Renseignez vos identifiants IAM et cliquez sur « Initialiser le SDK ».</li>
                <li>Définissez un filtre (ID ou tags) et lancez la recherche.</li>
                <li>Utilisez les boutons <em>Start</em> ou <em>Stop</em>. Le statut se met à jour automatiquement.</li>
            </ol>
            <p class="note">Fermez ce guide avec <kbd>Échap</kbd> ou le bouton ci-dessous.</p>
            <button value="close" class="primary">Fermer</button>
        </form>
    </dialog>

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1360.0.min.js" integrity="sha384-wZLwY0n1sSXX249oM2Zk4I5haX4YSCl8VQUC71aiGIHO2aeMBhYnQuoT0c8/tHrh" crossorigin="anonymous"></script>
    <script src="script.js"></script>
</body>
</html>
