<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interface web pour démarrer ou arrêter des instances EC2 AWS.">
    <title>Gestionnaire EC2 | Start & Stop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="app-header">
        <div class="container">
            <h1>Gestionnaire d'Instances EC2</h1>
            <p>
                Connectez-vous avec des identifiants temporaires AWS (IAM ou SSO) pour lancer ou arrêter vos instances EC2 en un clic.
                Les clés ne sont jamais stockées et restent dans votre navigateur.
            </p>
        </div>
    </header>

    <main class="container app-grid">
        <section class="panel" aria-labelledby="credentials-title">
            <div class="panel__header">
                <div>
                    <h2 id="credentials-title">Connexion AWS</h2>
                    <p class="panel__subtitle">Utilisez des identifiants temporaires ou un rôle limité aux actions EC2 nécessaires.</p>
                </div>
                <button id="resetCredentials" class="link-button" type="button" disabled>Effacer</button>
            </div>
            <form id="credentialsForm" class="form-grid" autocomplete="off">
                <label class="form-field">
                    <span>Access key ID <sup>*</sup></span>
                    <input type="text" id="accessKeyId" name="accessKeyId" required placeholder="AKIA..." spellcheck="false">
                </label>
                <label class="form-field">
                    <span>Secret access key <sup>*</sup></span>
                    <input type="password" id="secretAccessKey" name="secretAccessKey" required placeholder="Votre clé secrète">
                </label>
                <label class="form-field">
                    <span>Session token</span>
                    <textarea id="sessionToken" name="sessionToken" rows="3" placeholder="Collez votre token temporaire si nécessaire"></textarea>
                </label>
                <div class="form-row">
                    <label class="form-field">
                        <span>Région <sup>*</sup></span>
                        <input type="text" id="region" name="region" required placeholder="ex: eu-west-3" spellcheck="false">
                    </label>
                    <label class="form-field">
                        <span>Filtres de tag (optionnel)</span>
                        <input type="text" id="tagFilter" name="tagFilter" placeholder="ex: Environment=prod,Team=infra">
                    </label>
                </div>
                <div class="form-actions">
                    <button class="primary-button" type="submit" id="connectButton">Initialiser le client</button>
                    <span id="credentialStatus" class="status-badge status-badge--idle">Déconnecté</span>
                </div>
            </form>
            <details class="hint" open>
                <summary>Bonnes pratiques de sécurité</summary>
                <ul>
                    <li>Privilégiez des rôles IAM limités à <code>DescribeInstances</code>, <code>StartInstances</code> et <code>StopInstances</code>.</li>
                    <li>Utilisez AWS SSO ou STS pour générer des identifiants temporaires.</li>
                    <li>Aucune donnée n'est envoyée vers un serveur externe : tout reste local au navigateur.</li>
                </ul>
            </details>
        </section>

        <section class="panel" aria-labelledby="instances-title">
            <div class="panel__header">
                <div>
                    <h2 id="instances-title">Instances EC2</h2>
                    <p class="panel__subtitle">Listez vos instances et exécutez des actions instantanément.</p>
                </div>
                <div class="panel__actions">
                    <button class="secondary-button" type="button" id="refreshButton" disabled>Rafraîchir</button>
                </div>
            </div>

            <div id="instancesPlaceholder" class="placeholder">
                <div class="placeholder__icon" aria-hidden="true">☁️</div>
                <p>Initialisez le client AWS pour récupérer vos instances.</p>
            </div>

            <div class="table-wrapper" hidden>
                <table class="instances-table" aria-live="polite">
                    <thead>
                        <tr>
                            <th scope="col">Instance</th>
                            <th scope="col">Nom</th>
                            <th scope="col">Type</th>
                            <th scope="col">Zone</th>
                            <th scope="col">État</th>
                            <th scope="col" class="col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="instancesTableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <aside class="panel" aria-labelledby="activity-title">
            <div class="panel__header">
                <div>
                    <h2 id="activity-title">Journal d'activité</h2>
                    <p class="panel__subtitle">Suivez les appels API exécutés depuis l'interface.</p>
                </div>
                <button class="link-button" type="button" id="clearLog" disabled>Effacer</button>
            </div>
            <div id="activityLog" class="activity-log" aria-live="polite">
                <p class="log-placeholder">En attente d'actions...</p>
            </div>
        </aside>
    </main>

    <div id="toast" role="alert" aria-live="assertive" class="toast" hidden></div>

    <script type="module" src="script.js"></script>
</body>
</html>
